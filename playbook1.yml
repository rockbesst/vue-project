---
- name: Configure VueServer
  hosts: vue
  become: yes

  vars_files:
  - vars.yml

  tasks:
  - name: Update yum rep
    yum: 
        name: "*"
        state: latest
  
  - name: Install Nginx
    yum:
        name: http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm
        state: present
  
  - name: Set autorun for Nginx
    service:
        name: nginx
        state: started
        enabled: yes

  - name: Nginx configuring
    template:
        src: files/site.conf
        dest: /etc/nginx/sites-available/{{ server_name }}.conf

  - name: Enable site config template from Nginx available sites
    file:
        src: /etc/nginx/sites-available/{{ server_name }}.conf
        dest: /etc/nginx/sites-enabled/{{ server_name }}.conf
        state: link
    
  - name: Restart Nginx
    service:
        name: nginx
        state: restarted

  - name: Copying site files
    copy:
        src: "{{ site_src }}"
        dest: "{{ site_root_dir }}"